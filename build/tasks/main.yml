---
# tasks file for build

- name: check environment package is present
  apt: name={{item}} state=present
  with_items:
  - default-jdk
  - maven
  - git

- name: check project repository is cloned
  git: src=https://github.com/boxfuse/boxfuse-sample-java-war-hello.git dest={{work_folder}} clone=yes

- name: check artifact is exist
  stat: path={{work_folder}}/target/hello-1.0.war register=result

- name: create artifact
  shell: mvn package
  args: chdir={{work_folder}}
  when: result.stat.exists == false

- name: push artifact to master
  synchonize: src={{work_folder}}/target/hello-1.0.war dest=/tmp/hw9/artifact mode=pull